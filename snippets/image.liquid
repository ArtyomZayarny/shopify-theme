{% comment %}
  Renders an optimized responsive image with srcset and lazy loading.

  Accepts:
  - image: {Object} Image object (required)
  - alt: {String} Alt text override (optional, defaults to image.alt)
  - widths: {String} Comma-separated widths for srcset (optional, defaults to standard breakpoints)
  - sizes: {String} Sizes attribute for responsive images (optional)
  - lazy: {Boolean} Enable lazy loading (optional, default: true)
  - class: {String} Additional CSS classes (optional)
  - id: {String} Element ID (optional)

  Usage:
  {% render 'image', image: product.featured_image %}
  {% render 'image', image: section.settings.image, sizes: '100vw', lazy: false %}
{% endcomment %}

{%- liquid
  assign image_alt = alt | default: image.alt | escape
  assign image_lazy = lazy | default: true
  assign image_class = class | default: ''
  assign image_id = id | default: ''
-%}

{%- if image != blank -%}
  <img
    srcset="
      {%- if image.width >= 165 -%}{{ image | image_url: width: 165 }} 165w,{%- endif -%}
      {%- if image.width >= 360 -%}{{ image | image_url: width: 360 }} 360w,{%- endif -%}
      {%- if image.width >= 533 -%}{{ image | image_url: width: 533 }} 533w,{%- endif -%}
      {%- if image.width >= 720 -%}{{ image | image_url: width: 720 }} 720w,{%- endif -%}
      {%- if image.width >= 940 -%}{{ image | image_url: width: 940 }} 940w,{%- endif -%}
      {%- if image.width >= 1066 -%}{{ image | image_url: width: 1066 }} 1066w,{%- endif -%}
      {{ image | image_url }} {{ image.width }}w
    "
    src="{{ image | image_url: width: 533 }}"
    {%- if sizes %}
      sizes="{{ sizes }}"
    {%- else %}
      sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
    {%- endif %}
    alt="{{ image_alt }}"
    {%- if image_lazy %}
      loading="lazy"
      decoding="async"
    {%- else %}
      loading="eager"
      fetchpriority="high"
    {%- endif %}
    width="{{ image.width }}"
    height="{{ image.height }}"
    {%- if image_class != '' %} class="{{ image_class }}"{% endif -%}
    {%- if image_id != '' %} id="{{ image_id }}"{% endif -%}
  >
{%- endif -%}
